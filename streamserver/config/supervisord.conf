[supervisord]
; Membiarkan Supervisor tetap di-foreground (penting untuk Docker container)
nodaemon=true

; Level log supervisord (opsional: info, warn, debug)
loglevel=info

; ============================================================================
; 1) Program: ffmpeg_manager
; ============================================================================
[program:ffmpeg_manager]
command=python3 /app/streamserver/ffmpeg_manager.py
directory=/app/streamserver
autostart=true
autorestart=true
startsecs=5         ; tunggu 5 detik untuk menilai apakah start sukses
startretries=3      ; coba start ulang hingga 3x jika gagal
priority=10         ; prioritas start (lebih kecil = lebih dahulu start)
killasgroup=true     ; hentikan child process saat kill
stopasgroup=true     ; hentikan child process saat stop
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0

; ============================================================================
; 2) Program: Gunicorn (Flask/FastAPI)
; ============================================================================
[program:gunicorn_app]
command=gunicorn --bind 0.0.0.0:8080 --timeout 300 --workers 1 main:app
directory=/app/streamserver
autostart=true
autorestart=true
startsecs=5
startretries=3
priority=20
killasgroup=true
stopasgroup=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0

; ============================================================================
; 3) Program: snapshot_cctv
;    (bisa diganti dynamic_snapshot_cctv.py jika sudah memakai script dinamis)
; ============================================================================
[program:snapshot_cctv]
command=python3 /app/streamserver/snapshot_cctv.py
directory=/app/streamserver
autostart=true
autorestart=true
startsecs=5
startretries=3
priority=30
killasgroup=true
stopasgroup=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0